<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/src/static/css/sytle.css">
    <script src="/src/static/js/script.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>Edupork</title>
</head>
<body class="body__porcinos">
    <nav class="nav__bar">
        <ul class="nav__list">
            <li class="nav__item">
                <a href="/src/templates/home.html" onclick="redirectWithDelay(event, 'home.html')" ><img src="/src/static/iconos/home icon.svg" alt=""></a>
            </li>
            <li class="nav__item">
                <a href="#"><img src="/src/static/iconos/notificacions.svg" alt=""></a>
            </li>
            <li class="nav__item ">
                <a href="/src/templates/alimento.html" onclick="redirectWithDelay(event, 'alimento.html')" ><img src="/src/static/iconos/icon pig.svg" alt=""></a>
            </li>
            <li class="nav__item active"> 
                <a href="/src/templates/alimentos.html" onclick="redirectWithDelay(event, 'alimentos.html')"><img src="/src/static/iconos/icon wheate.svg" alt=""></a>
            </li>
            <li class="nav__item">
                <a href="/src/templates/dietas.html"><img src="/src/static/iconos/icon plate.svg" alt=""></a>
            </li>
            <li class="nav__item">
                <a href="#"><img src="/src/static/iconos/icon page.svg" alt=""></a>
            </li>
            <li class="nav__item">
                <a href="/src/templates/perfil.html" onclick="redirectWithDelay(event, 'perfil.html')" ><img src="/src/static/iconos/icon user.svg" alt=""></a>
            </li>
            <li class="nav__item">
                <a href="/src/templates/configuracion.html" onclick="redirectWithDelay(event, 'configuracion.html')" ><img src="/src/static/iconos/icon setting.svg" alt=""></a>
            </li>
            <div class="indicador"></div>
        </ul>
    </nav>
    <section class="section__add__por" >

        <section class="container__logo__user">
            <div class="container__back__logo" >
                <a href="alimentos.html">
                    <img src="/src/static/iconos/back icon.svg" alt="icon back" class="icon__back">
                </a>
                <a href="/src/templates/home.html">
                    <img src="/src/static/iconos/Logo.svg" alt="Logo Edupork" class="logo">
                </a>
            </div>
            <div class="container__user__btn">
                <img src="/src/static/iconos/icon user.svg" alt="" class="svg__user">
                <button type="button" class="btn__perfil">cristhian U</button>
            </div>
        </section>

        <header class="container container__title">
            <h1>Registrar alimento</h1>
        </header>
        <form onsubmit="consultar_">


            <section class="container container_alimento container__add__por">
                <div class="seccion1">
                    <p>inserte una imagen</p>
                    <input id="imagen"  class="input_add" tabindex="1" placeholder="ingrese una imagen" type="file" accept=".png, .jpeg, .jpg">
                    <p>proteina cruda(%)</p>
                    <input class="input_add" tabindex="5" type="number" required step="any" placeholder="ingrese la proteina cruda" id="proteina_cruda">
                    <p>fosforo (%)</p>
                    <input class="input_add" tabindex="9" type="number" required step="any" placeholder="ingrese el fosforo" id="fosforo">
                    <p>treitona(%)</p>
                    <input class="input_add" tabindex="13" type="number" required step="any" placeholder="ingrese la treitona" id="treitona">
                </div>
                <div class="seccion1">
                    <p>nombre del alimento</p>
                    <input class="input_add" tabindex="2" type="text" placeholder="ingrese el nombre" id="nombre">
                    <p>fibra cruda(%)</p>
                    <input class="input_add" tabindex="6" type="number" required step="any" placeholder="ingrese la fibra cruda" id="fibra_cruda">
                    <p>sodio(%)</p>
                    <input class="input_add" tabindex="10" type="number" required step="any" placeholder="ingrese el sodio" id="sodio">
                    <p>metionina(%)</p>
                    <input class="input_add" tabindex="14" type="number" required step="any" placeholder="ingrese la metionina" id="metionina">
                </div>
                <div class="seccion1">
                    <p>materia seca(%)</p>
                    <input class="input_add" tabindex="3" type="number" required step="any" placeholder="ingrese la materia seca" id="materia_seca">
                    <p>extracto etereo(%)</p>
                    <input class="input_add" tabindex="7" type="number" required step="any" placeholder="ingrese el extracto etereo" id="extracto_etereo">
                    <p>arginina(%)</p>
                    <input class="input_add" tabindex="11" type="number" required step="any" placeholder="ingrese la arginina" id="arginina">
                    <p>metionina + cisteina(%)</p>
                    <input class="input_add" tabindex="15" type="number" required step="any" placeholder="ingrese la metionina + cisteina" id="metionina_cistenina">
                </div>
                <div class="seccion1">
                    <p>Energia M(Kcal/kg)</p>
                    <input class="input_add" tabindex="4" type="number" required step="any" placeholder="ingrese la energia_metabolizable" id="energia_m">
                    <p>calcio(%)</p>
                    <input class="input_add" tabindex="8" type="number" required step="any" placeholder="ingrese el calcio" id="calcio">
                    <p>lisina(%)</p>
                    <input class="input_add" tabindex="12" type="number" required step="any" placeholder="ingrese la lisina" id="lisina">
                    <p>triptofano(%)</p>
                    <input class="input_add" tabindex="16" type="number" required step="any" placeholder="ingrese el triptofano" id="triptofano">
    
                </div>
                <input class="input_add1" tabindex="17" value="guardar" type="submit">
            </section>
                
                
        </form>


    </section>
    <script>
document.querySelector("form").addEventListener("submit", function (e) {
  e.preventDefault();

  const formData = new FormData();

  const imagen = document.getElementById("imagen").files[0];
  formData.append("imagen", imagen);

  const nombre = document.getElementById("nombre").value;
  formData.append("nombre_alimento", nombre);

  const elementos = [
    { id: 1, valor: parseFloat(document.getElementById("proteina_cruda").value) || 0 },
    { id: 2, valor: parseFloat(document.getElementById("treitona").value) || 0 },
    { id: 3, valor: parseFloat(document.getElementById("fosforo").value) || 0 },
    { id: 4, valor: parseFloat(document.getElementById("fibra_cruda").value) || 0 },
    { id: 5, valor: parseFloat(document.getElementById("sodio").value) || 0 },
    { id: 6, valor: parseFloat(document.getElementById("metionina").value) || 0 },
    { id: 7, valor: parseFloat(document.getElementById("materia_seca").value) || 0 },
    { id: 8, valor: parseFloat(document.getElementById("extracto_etereo").value) || 0 },
    { id: 9, valor: parseFloat(document.getElementById("arginina").value) || 0 },
    { id: 10, valor: parseFloat(document.getElementById("metionina_cistenina").value) || 0 },
    { id: 11, valor: parseFloat(document.getElementById("calcio").value) || 0 },
    { id: 12, valor: parseFloat(document.getElementById("lisina").value) || 0 },
    { id: 13, valor: parseFloat(document.getElementById("triptofano").value) || 0 },
    { id: 14, valor: parseFloat(document.getElementById("energia_m").value) || 0 }
  ];
  formData.append("elementos", JSON.stringify(elementos));

  fetch("http://127.0.0.1:5000/registrar_alimento/", {
    method: "POST",
    body: formData  
  })
  .then(async res => {
      const text = await res.text();
      if (!text) throw new Error("Respuesta vacía del servidor");
      return JSON.parse(text);
  })
  .then(res => {
      if (res.mensaje) {
          Swal.fire("Éxito", res.mensaje, "success");
          window.location.href="alimentos.html";
      } else if (res.error) {
          Swal.fire("Error", res.error, "error");
      }
  })
  .catch(err => Swal.fire("Error", err.message, "error"));
});
</script>

</body>
</html>