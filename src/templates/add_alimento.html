<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="/src/static/css/sytle.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.17.2/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>Edupork</title>
</head>
<body class="body__porcinos">
    <section class="section-nav-bar" >
        <div class="container-user">
            <div class="container__btn__perfil">
                <img src="../static/iconos/icon user.svg" alt="" width="25" class="svg__user__2">
                <button type="button" class="btn__perfil">Juan Tovar</button>
            </div>
            <div class="menu">
                <img src="../static/iconos/menu_icon.svg" alt="" class="menu-icons">
                <img src="../static/iconos/close_icon.svg" alt="" class="menu-icons">
            </div>
        </div>
        <div class="barra-lateral">
            <div>
                <div class="logo-edupork">
                    <img id="cerdo" class="nombre" src="../static/iconos/cerdo.png" width="20px" alt="">
                    <span>Edupork</span>
                </div>
            </div>
            <nav class="navegacion">
                <ul class="ul-navegacion">
                    <li>
                        <a href="/src/templates/home.html" onclick="redirectWithDelay(event, 'home.html')" > <!--dar estilo -->
                            <img src="../static/iconos/home icon.svg" width="20px" alt="" class="icons-bar">
                            <span>Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="/src/templates/notificaciones.html">
                            <img src="../static/iconos/notificacions.svg" width="20px" alt="" class="icons-bar">
                            <span>Notificaciones </span>
                        </a>
                    </li>
                    <li>
                        <a href="/src/templates/porcinos.html" onclick="redirectWithDelay(event, 'porcinos.html')">
                            <img src="../static/iconos/icon pig.svg" width="20px" alt="" class="icons-bar">
                            <span>Porcinos</span>
                        </a>
                    </li>
                    <li>
                        <a href="/src/templates/alimentos.html" onclick="redirectWithDelay(event, 'alimentos.html')">
                            <img src="../static/iconos/icon wheate.svg" title="alimentos" width="20px" alt="" class="icons-bar">
                            <span>Alimentos</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <img src="../static/iconos/icon plate.svg" width="20px" alt="" class="icons-bar">
                            <span>Dietas</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <img src="../static/iconos/icon page.svg" alt="" class="icons-bar">
                            <span>Informes</span>
                        </a>
                    </li>
                    <li>
                        <a href="/src/templates/perfil.html" onclick="redirectWithDelay(event, 'perfil.html')">
                            <img src="../static/iconos/icon user.svg" width="20px" alt="" class="icons-bar">
                            <span>Usuario</span>
                        </a>
                    </li>
                    <li>
                        <a href="/src/templates/configuracion.html" onclick="redirectWithDelay(event, 'configuracion.html')">
                            <img src="../static/iconos/icon setting.svg" width="20px" alt="" class="icons-bar">
                            <span>Configuración</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </section>
    <section class="section__add__por" >

    <section class="section__add__por">
        <section class="container__logo__user">
            <div class="container__back__logo">
                <a href="alimentos.html"><img src="/src/static/iconos/back icon.svg" alt="Icon Back" class="icon__back"></a>
                <a href="/src/templates/home.html"><img src="/src/static/iconos/Logo.svg" alt="Logo Edupork" class="logo"></a>
            </div>
            <div class="container__user__btn">
                <img src="/src/static/iconos/icon user.svg" alt="" class="svg__user">
                <button type="button" class="btn__perfil" id="btnPerfil">
                    <span id="nombreUsuarioTexto"></span>
                    <i class="fa fa-caret-down"></i>
                </button>
                <div class="usuario-menu" id="usuarioMenu">
                    <a href="perfil.html">Mi perfil</a>
                    <a href="#" id="cerrarSesionBtn">Cerrar sesión</a>
                </div>
            </div>
        </section>

        <header class="container container__title">
            <h1>Registrar Alimento</h1>
        </header>

        <form id="formRegistrar">
            <section class="container container_alimento container__add__por">
                <div class="seccion1">
                    <p>Inserte Una Imagen</p>
                    <input id="imagen" class="input_add" type="file" accept=".png, .jpeg, .jpg">
                    <p>Proteína Cruda (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Proteína Cruda" id="proteina_cruda">
                    <p>Fósforo (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese El Fósforo" id="fosforo">
                    <p>Treitona (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Treitona" id="treitona">
                </div>

                <div class="seccion1">
                    <p>Nombre Del Alimento</p>
                    <input class="input_add" type="text" placeholder="Ingrese El Nombre" id="nombre" required>
                    <p>Fibra Cruda (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Fibra Cruda" id="fibra_cruda">
                    <p>Sodio (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese El Sodio" id="sodio">
                    <p>Metionina (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Metionina" id="metionina">
                </div>

                <div class="seccion1">
                    <p>Materia Seca (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Materia Seca" id="materia_seca">
                    <p>Extracto Etéreo (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese El Extracto Etéreo" id="extracto_etereo">
                    <p>Arginina (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Arginina" id="arginina">
                    <p>Metionina + Cisteína (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Metionina + Cisteína" id="metionina_cistenina">
                </div>

                <div class="seccion1">
                    <p>Energía M (Kcal/kg)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Energía Metabolizable" id="energia_m">
                    <p>Calcio (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese El Calcio" id="calcio">
                    <p>Lisina (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese La Lisina" id="lisina">
                    <p>Triptofano (%)</p>
                    <input class="input_add" type="number" required step="any" min="0" placeholder="Ingrese El Triptofano" id="triptofano">
                </div>

                <input class="input_add1" value="Guardar" type="submit">
            </section>
        </form>
    </section>

    <script>
        document.getElementById("formRegistrar").addEventListener("submit", function (e) {
    e.preventDefault();

    const numeros = document.querySelectorAll('input[type="number"]');
    for (let input of numeros) {
        if (parseFloat(input.value) < 0) {
            Swal.fire({
                title: "Valor inválido",
                text: "No se permiten números negativos.",
                icon: "warning",
                confirmButtonText: "Entendido"
            });
            return; 
        }
    }

    const formData = new FormData();
    const imagen = document.getElementById("imagen").files[0];
    if (imagen) {
        formData.append("imagen", imagen);
    }

    formData.append("nombre_alimento", document.getElementById("nombre").value);

    const elementos = [
        { id: 1, valor: parseFloat(document.getElementById("proteina_cruda").value) || 0 },
        { id: 2, valor: parseFloat(document.getElementById("treitona").value) || 0 },
        { id: 3, valor: parseFloat(document.getElementById("fosforo").value) || 0 },
        { id: 4, valor: parseFloat(document.getElementById("fibra_cruda").value) || 0 },
        { id: 5, valor: parseFloat(document.getElementById("sodio").value) || 0 },
        { id: 6, valor: parseFloat(document.getElementById("metionina").value) || 0 },
        { id: 7, valor: parseFloat(document.getElementById("materia_seca").value) || 0 },
        { id: 8, valor: parseFloat(document.getElementById("extracto_etereo").value) || 0 },
        { id: 9, valor: parseFloat(document.getElementById("arginina").value) || 0 },
        { id: 10, valor: parseFloat(document.getElementById("metionina_cistenina").value) || 0 },
        { id: 11, valor: parseFloat(document.getElementById("calcio").value) || 0 },
        { id: 12, valor: parseFloat(document.getElementById("lisina").value) || 0 },
        { id: 13, valor: parseFloat(document.getElementById("triptofano").value) || 0 },
        { id: 14, valor: parseFloat(document.getElementById("energia_m").value) || 0 }
    ];
    formData.append("elementos", JSON.stringify(elementos));

    fetch("http://127.0.0.1:5000/registrar_alimento", {
        method: "POST",
        body: formData
    })
    .then(async res => {
        const text = await res.text();
        if (!text) throw new Error("Respuesta vacía del servidor");
        return JSON.parse(text);
    })
    .then(res => {
        if (res.mensaje) {
            Swal.fire({
                title: "Registrado",
                text: res.mensaje,
                icon: "success",
                confirmButtonText: "Aceptar",
                allowOutsideClick: false,
                allowEscapeKey: false
            }).then(result => {
                if (result.isConfirmed) {
                    window.location.href = "alimentos.html";
                }
            });
        } else if (res.error) {
            Swal.fire("Error", res.error, "error");
        }
    })
    .catch(err => Swal.fire("Error", err.message, "error"));
});
    </script>
</body>
</html>
